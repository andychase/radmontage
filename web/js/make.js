// Generated by CoffeeScript 1.9.3
var ajax_channel_and_title, api_key, append_new_video_container, append_new_video_container_if_empty, get_link_from_montage_container, link_to_img, make_link_container, montage_link_container, montage_link_entered, set_video_image, set_video_title, video_title_markup, youtube_api_endpoint, youtube_channel_link, youtube_video_link;

api_key = "AIzaSyDNunorfrD4Wp21oL0F96Ov_L8mb9rdw_s";

youtube_api_endpoint = 'https://www.googleapis.com/youtube/v3/videos';

youtube_video_link = "https://www.youtube.com/watch?v=";

youtube_channel_link = "https://www.youtube.com/channel/";

ajax_channel_and_title = function(id, func) {
  return $.ajax({
    url: youtube_api_endpoint,
    data: {
      part: 'snippet',
      id: id,
      key: api_key
    },
    localCache: true,
    cacheTTL: 5,
    dataType: 'json',
    cacheKey: id
  }).done(function(response) {
    return func(response);
  });
};

link_to_img = function(id) {
  return "https://i.ytimg.com/vi/" + id + "/mqdefault.jpg";
};

set_video_image = function(target, url) {
  var img;
  target.css("background-image", "url('img/testCard.gif')");
  img = new Image;
  img.onload = function() {
    return target.css("background-image", "url('" + url + "')");
  };
  return img.src = url;
};

video_title_markup = function(channel_id, channel_title, title, id) {
  return ("<a href='" + youtube_channel_link + channel_id + "'>" + channel_title + "</a>") + ("<span>/</span><a href='" + youtube_video_link + id + "'>" + title + "</a>");
};

set_video_title = function(target, id) {
  return ajax_channel_and_title(id, function(response) {
    var channel_id, channel_title, title;
    title = response.items[0].snippet.title;
    channel_id = response.items[0].snippet.channelId;
    channel_title = response.items[0].snippet.channelTitle;
    return target.html(video_title_markup(channel_id, channel_title, title, id));
  });
};

make_link_container = "<div class=\"row-container\">\n        <div class=\"row-box thumb\">\n\n        </div>\n        <div class=\"row-box info-box-space\">\n            <div class=\"montage-form-group\">\n                <h2 class=\"montageTitle\">&nbsp;</h2>\n                <label for=\"montageUrl1\"></label>\n                <input type=\"text\" id=\"montageUrl1\" class=\"montageUrl\" placeholder=\"Put the youtube url here\"/><br/>\n                <input type=\"text\" id=\"montageStart1\" class=\"montageStart\" placeholder=\"0:00\" maxlength=\"6\"/>\n                <input type=\"text\" id=\"montageEnd1\" class=\"montageEnd\" placeholder=\"0:00\" maxlength=\"6\"/>\n            </div>\n        </div>\n    </div>";

montage_link_container = void 0;

get_link_from_montage_container = function(container) {
  return container.children(".info-box-space").children(".montage-form-group").children(".montageUrl");
};

append_new_video_container = function() {
  var new_container, url_target;
  new_container = $(make_link_container);
  montage_link_container.append(new_container);
  url_target = get_link_from_montage_container(new_container);
  url_target.change(montage_link_entered);
  return url_target.keydown(montage_link_entered);
};

append_new_video_container_if_empty = function() {
  if (montage_link_container) {
    if (get_link_from_montage_container(montage_link_container.children().last()).val().trim().length) {
      return append_new_video_container();
    }
  }
};

montage_link_entered = function(e) {
  var id, target;
  if (e.target.value.split("=").length > 1) {
    id = e.target.value.split("=")[1].split("&")[0];
    if (id.length === 11) {
      target = $(e.target.parentNode.parentNode.parentNode).children(".thumb").first();
      set_video_image(target, link_to_img(id));
      target = $(e.target.parentNode).children(".montageTitle").first();
      set_video_title(target, id);
      return append_new_video_container_if_empty();
    }
  }
};

$(function() {
  montage_link_container = $("#montage-links-container");
  return append_new_video_container();
});

//# sourceMappingURL=make.js.map
