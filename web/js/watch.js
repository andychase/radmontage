// Generated by CoffeeScript 1.9.3
var get_video_end, get_video_start, get_video_url, iOS, if_zero_return_null, onPlayerReady, onPlayerStateChange, onYouTubeIframeAPIReady, player, ready, testCardImageBasePath, video_end, videos;

videos = window.videos;

player = void 0;

iOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;

ready = false;

testCardImageBasePath = "https://d12gd74eaa9d1v.cloudfront.net/";

onYouTubeIframeAPIReady = function() {
  return player = new YT.Player('player', {
    playerVars: {
      controls: 0,
      showinfo: 0,
      iv_load_policy: 3
    },
    events: {
      onReady: function() {
        return onPlayerReady();
      },
      onStateChange: function(e) {
        return onPlayerStateChange(e);
      }
    }
  });
};

onPlayerReady = function() {
  return ready = true;
};

onPlayerStateChange = function() {};

if_zero_return_null = function(i) {
  if (i === 0) {
    return null;
  } else {
    return i;
  }
};

get_video_url = function(videos, video_index) {
  return videos[3 * video_index];
};

get_video_start = function(videos, video_index) {
  return if_zero_return_null(videos[3 * video_index + 1]);
};

get_video_end = function(videos, video_index) {
  return if_zero_return_null(videos[3 * video_index + 2]);
};

video_end = function(container, end_splash) {
  $("body").addClass("video-done");
  $("html").addClass("video-done");
  container.hide();
  container.remove();
  end_splash.show();
  if (iOS) {
    $('.adsbygoogle').hide();
    return $('ios_code').appendTo($("head"));
  } else {
    (window.adsbygoogle || []).push({});
    return (window.adsbygoogle || []).push({});
  }
};

$(function() {
  var bgvid, clearOverlay, click_movie_function, end_splash, instructions, montage_name, need_to_show_instructions, overlay, overlay_i, overlays, playing, showStaticOverlay, video_index;
  instructions = $("#instructions");
  need_to_show_instructions = true;
  overlay = $('#overlay');
  end_splash = $('#end-splash');
  bgvid = $('#bgvid');
  overlay_i = 0;
  video_index = 0;
  playing = true;
  if (iOS) {
    bgvid.hide();
    overlay.addClass("ios");
    instructions.addClass("ios");
    overlay.html("<span>SKIP</span>");
  }
  clearOverlay = function() {
    if (!iOS) {
      return playing = true;
    }
  };
  overlays = [[false, 'testCard', 150], [true, 'testCard', 900], [false, 'testCard', 600]];
  showStaticOverlay = function() {
    var i;
    if (false) {
      if (overlay_i > overlays.length - 1) {
        overlay_i = 0;
      }
      i = overlay_i;
      overlay.css('height', '100%');
      overlay.css('background-image', "url('" + testCardImageBasePath + overlays[i][1] + ".gif')");
      if (overlays[i][0] === true) {
        bgvid.show();
      } else {
        bgvid.hide();
      }
      overlay_i += 1;
      return setTimeout(showStaticOverlay, overlays[i][2]);
    }
  };
  montage_name = videos[0];
  videos = videos.slice(1);
  click_movie_function = function() {
    if (playing || iOS) {
      playing = false;
      showStaticOverlay();
      if (video_index < (videos.length / 3)) {
        player.loadVideoById({
          videoId: get_video_url(videos, video_index),
          startSeconds: get_video_start(videos, video_index),
          endSeconds: get_video_end(videos, video_index),
          suggestedQuality: 'large'
        });
        return video_index += 1;
      } else {
        player.stopVideo();
        return setTimeout(function() {
          document.onmousemove = null;
          clearOverlay();
          return video_end(overlay.parent(), end_splash);
        }, 400);
      }
    }
  };
  onPlayerStateChange = function(event) {
    if (event.data === YT.PlayerState.PLAYING) {
      clearOverlay();
      if (need_to_show_instructions && !iOS) {
        need_to_show_instructions = false;
        instructions.show();
        return instructions.fadeOut(5000);
      }
    } else if (event.data === YT.PlayerState.ENDED) {
      return click_movie_function();
    }
  };
  overlay[0].addEventListener('click', click_movie_function, true);
  if (ready) {
    click_movie_function();
  } else {
    onPlayerReady = function() {
      return click_movie_function();
    };
  }
  return (function() {
    var cursorVisible, disappearCursor, mouseTimer;
    overlay = $("#overlay");
    mouseTimer = null;
    cursorVisible = true;
    disappearCursor = function() {
      mouseTimer = null;
      overlay.css('cursor', 'none');
      return cursorVisible = false;
    };
    return document.onmousemove = function() {
      if (mouseTimer) {
        window.clearTimeout(mouseTimer);
      }
      if (!cursorVisible) {
        overlay.css('cursor', "url('/img/forward_cursor.png') 0 0, e-resize");
        cursorVisible = true;
      }
      return mouseTimer = window.setTimeout(disappearCursor, 3000);
    };
  })();
});
