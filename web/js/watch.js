// Generated by CoffeeScript 1.9.3
var get_param_and_start, get_video_end, get_video_start, get_video_url, if_zero_return_null, onPlayerReady, onPlayerStateChange, onYouTubeIframeAPIReady, player, playing, ready, when_ready_run;

player = void 0;

ready = false;

onYouTubeIframeAPIReady = function() {
  return player = new YT.Player('player', {
    playerVars: {
      controls: 0,
      showinfo: 0
    },
    events: {
      'onReady': onPlayerReady,
      'onStateChange': onPlayerStateChange
    }
  });
};

onPlayerReady = function() {
  return ready = true;
};

onPlayerStateChange = function() {};

playing = false;

get_param_and_start = function(func) {
  var id, param;
  param = window.location.search.substring(1).split("?m=");
  if (param.length > 0 && param[0].length > 0) {
    id = param[0];
    return $.get("https://radmontage.herokuapp.com/get.php", {
      id: id
    }, func, 'json');
  }
};

when_ready_run = function(func) {
  if (ready) {
    return func();
  } else {
    return onPlayerReady = function() {
      ready = true;
      return func();
    };
  }
};

if_zero_return_null = function(i) {
  if (i === 0) {
    return null;
  } else {
    return i;
  }
};

get_video_url = function(videos, video_index) {
  return videos[3 * video_index];
};

get_video_start = function(videos, video_index) {
  return if_zero_return_null(videos[3 * video_index + 1]);
};

get_video_end = function(videos, video_index) {
  return if_zero_return_null(videos[3 * video_index + 2]);
};

$(function() {
  var clearOverlay, overlay, overlay_i, overlays, showStaticOverlay, video_index;
  overlay = $('#overlay');
  overlay_i = 0;
  video_index = 0;
  clearOverlay = function() {
    overlay.css('background-image', '');
    overlay.css('height', '92%');
    overlay_i = 0;
    return playing = true;
  };
  overlays = [['', 'testCard', 150], ['contain', 'testCard2', 600], ['', 'testCard', 600]];
  onPlayerStateChange = function(event) {
    if (event.data === YT.PlayerState.PLAYING) {
      return clearOverlay();
    }
  };
  showStaticOverlay = function() {
    var i;
    if (!playing) {
      if (overlay_i > overlays.length - 1) {
        overlay_i = 0;
      }
      i = overlay_i;
      overlay.css('height', '100%');
      overlay.css('background-size', overlays[i][0]);
      overlay.css('background-image', "url('img/" + overlays[i][1] + ".gif')");
      overlay_i += 1;
      return setTimeout(showStaticOverlay, overlays[i][2]);
    }
  };
  return get_param_and_start(function(videos) {
    return when_ready_run(function() {
      var click_movie_function;
      click_movie_function = function() {
        playing = false;
        showStaticOverlay();
        player.loadVideoById({
          videoId: get_video_url(videos, video_index),
          startSeconds: get_video_start(videos, video_index),
          endSeconds: get_video_start(videos, video_index),
          suggestedQuality: 'large'
        });
        return video_index += 1;
      };
      return overlay[0].addEventListener('click', click_movie_function, true);
    });
  });
});
